<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Doƒüruel Kuyumculuk Hƒ±zlƒ± ƒ∞≈ülem Paneli</title>
    <style>
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; visibility: hidden; }
    }
    .fade-out {
        animation: fadeOut 0.6s ease forwards;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    .fade-in {
        animation: fadeIn 0.6s ease forwards;
    }
    body {
        font-family: 'Segoe UI', sans-serif;
        background-color: #111;
        margin: 0;
        padding: 0;
        color: #f1f1f1;
    }
    .header {
        background-color: #1e1e1e;
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(255, 215, 0, 0.2);
    }
    .header h1 {
        color: gold;
        font-size: 22px;
    }
    .container {
        display: flex;
        padding: 20px;
    }
    .menu {
        flex: 1;
        background-color: #1c1c1c;
        padding: 20px;
        border-radius: 10px;
        margin-right: 20px;
    }
    .menu h3 {
        color: gold;
        border-bottom: 1px solid #333;
        padding-bottom: 10px;
    }
    .menu button {
        display: block;
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        background-color: #222;
        color: gold;
        border: none;
        border-radius: 5px;
        text-align: left;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    .menu button:hover {
        background-color: #333;
    }
    .panel {
        flex: 2;
        background-color: #1c1c1c;
        padding: 20px;
        border-radius: 10px;
    }
    .panel input[type="number"] {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        border-radius: 5px;
        border: none;
        background-color: #2b2b2b;
        color: #fff;
    }
    .toggle {
        display: flex;
        margin: 10px 0;
    }
    .toggle button {
        flex: 1;
        padding: 12px;
        background-color: #2b2b2b;
        color: #ccc;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        margin-right: 10px;
    }
    .toggle button.active {
        background-color: gold;
        color: #111;
        font-weight: bold;
    }
    .calc-output {
        font-size: 20px;
        color: #f66;
        margin-top: 10px;
    }
    .keypad {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 20px;
    }
    .keypad button {
        padding: 20px;
        font-size: 20px;
        background-color: #222;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .keypad button:hover {
        background-color: #333;
    }
    #submitBtn {
        width: 100%;
        margin-top: 20px;
        padding: 15px;
        background-color: red;
        color: white;
        font-weight: bold;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }
    #clearBtn {
        width: 100%;
        margin-top: 10px;
        padding: 10px;
        background-color: darkred;
        color: white;
        font-weight: bold;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    #summaryBox {
        margin-top: 30px;
        background: #222;
        padding: 15px;
        border-radius: 8px;
        font-size: 16px;
        color: gold;
    }
    </style>
</head>
<body class="fade-in">

    <!-- Gƒ∞Rƒ∞≈û PANELƒ∞ -->
    <div id="loginPanel" style="position:fixed; inset:0; background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)), url('43391571.jpg'); background-size:cover; background-position:center; z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center; backdrop-filter:blur(4px);">
        <h2 style="color:gold; margin-bottom:20px; text-shadow:1px 1px 5px black;">üîê Giri≈ü Yap</h2>
        <input type="password" id="passwordInput" placeholder="≈ûifre" style="padding:12px; font-size:16px; border-radius:5px; border:none; background:rgba(0,0,0,0.7); color:gold; text-align:center;">
        <button onclick="checkPassword()" style="margin-top:15px; padding:12px 25px; font-size:16px; background:linear-gradient(to right, gold, orange); color:black; font-weight:bold; border:none; border-radius:5px; cursor:pointer;">Giri≈ü</button>
        <div id="loginError" style="color:#f66; margin-top:10px;"></div>
    </div>

    <!-- BA≈ûLIK -->
    <div class="header">
        <h1>üíé Doƒüruel Kuyumculuk Hƒ±zlƒ± ƒ∞≈ülem Paneli</h1>
    </div>

    <div class="container">
        <!-- MEN√ú -->
        <div class="menu">
            <h3>D√∂viz √úr√ºnleri</h3>
            <button data-urun="Has Altƒ±n">Has Altƒ±n</button>
            <button data-urun="Dolar">Dolar</button>
            <button data-urun="Euro">Euro</button>
            <button data-urun="Sterlin">Sterlin</button>
            <button data-urun="Gram Altƒ±n">Gram Altƒ±n</button>
            <button data-urun="√áeyrek">√áeyrek</button>
            <button data-urun="Yarƒ±m">Yarƒ±m</button>
            <button data-urun="Cumhuriyet">Cumhuriyet</button>
            <button data-urun="Ata Lira">Ata Lira</button>
            <div id="priceTimeInfo" style="font-size:10px; color:#888; margin-top:5px;"></div>
        </div>

        <!-- PANEL -->
        <div class="panel">
            <div class="toggle">
                <button id="satisBtn" class="active" onclick="setMode('satis')">SATI≈û</button>
                <button id="alisBtn" onclick="setMode('alis')">ALI≈û</button>
            </div>
            <div id="selectedProduct">√úr√ºn: -</div>
            <input type="number" id="adet" placeholder="Adet girin">
            <div class="calc-output" id="calcResult">Tutar: 0 TL</div>
            <div class="keypad">
                <button onclick="appendNumber(1)">1</button>
                <button onclick="appendNumber(2)">2</button>
                <button onclick="appendNumber(3)">3</button>
                <button onclick="appendNumber(4)">4</button>
                <button onclick="appendNumber(5)">5</button>
                <button onclick="appendNumber(6)">6</button>
                <button onclick="appendNumber(7)">7</button>
                <button onclick="appendNumber(8)">8</button>
                <button onclick="appendNumber(9)">9</button>
                <button onclick="clearInput()">Sƒ∞L</button>
                <button onclick="appendNumber(0)">0</button>
                <button onclick="calculate()">=</button>
            </div>
            <button id="submitBtn" onclick="submitTransaction()">ƒ∞≈ûLEMƒ∞ TAMAMLA</button>
            <button id="clearBtn" onclick="clearTransactions()">üóë Ge√ßmi≈üi Temizle</button>
            <div id="transactionHistory" style="margin-top:30px; border-top:1px solid #333; padding-top:20px;"></div>
            <div id="summaryBox">Toplam K√¢r: 0 TL</div>
            <button id="exportBtn" style="
                margin-top: 20px;
                padding: 10px 20px;
                font-size: 14px;
                background: linear-gradient(to right, #444, #222);
                color: gold;
                border: 1px solid #555;
                border-radius: 5px;
                cursor: pointer;
            ">üì§ Verileri Dƒ±≈üa Aktar</button>

        </div>
    </div>

    <!-- JAVASCRIPT -->
     <script>
    let currentMode = 'satis';
    let selected = { name: '', price: 0 };
    const transactions = [];
    let totalProfit = 0;
    const prices = {};

    async function fetchPrices() {
        try {
            const res = await fetch("https://api.allorigins.win/raw?url=https://finans.truncgil.com/v4/today.json");
            const data = await res.json();
            prices["Dolar"] = parseFloat(data["USD"]["Selling"]);
            prices["Euro"] = parseFloat(data["EUR"]["Selling"]);
            prices["Sterlin"] = parseFloat(data["GBP"]["Selling"]);
            prices["Has Altƒ±n"] = parseFloat(data["HAS"]?.Selling || 0);
            prices["√áeyrek"] = parseFloat(data["CEY"]?.Selling || prices["Has Altƒ±n"] * 1.75);
            prices["Yarƒ±m"] = parseFloat(data["YAR"]?.Selling || prices["Has Altƒ±n"] * 3.5);
            prices["Ata Lira"] = parseFloat(data["ATA"]?.Selling || prices["Has Altƒ±n"] * 7.2);
            prices["Gram Altƒ±n"] = parseFloat(data["GRA"]?.Selling || 0);
            prices["Cumhuriyet"] = parseFloat(data["CUM"]?.Selling || 0);
            updateMenuButtons();
        } catch (e) {
            alert("Veriler alƒ±namadƒ±.");
        }
    }

    function updateMenuButtons() {
        const urunler = Object.keys(prices);
        urunler.forEach(urun => {
            const btn = document.querySelector(`button[data-urun='${urun}']`);
            if (btn) btn.innerText = `${urun} ‚Äì ${prices[urun]?.toFixed(2) || '?'} TL`;
        });
        const now = new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        document.getElementById("priceTimeInfo").innerText = `üïí Fiyat G√ºncellenme: ${now}`;
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('satisBtn').classList.toggle('active', mode === 'satis');
        document.getElementById('alisBtn').classList.toggle('active', mode === 'alis');
        calculate();
    }

    function selectProduct(name, price) {
        selected.name = name;
        selected.price = price;
        document.getElementById('selectedProduct').innerText = `√úr√ºn: ${name}`;
        calculate();
    }

    function appendNumber(num) {
        const adetInput = document.getElementById("adet");
        adetInput.value += num;
        calculate();
    }

    function clearInput() {
        document.getElementById("adet").value = '';
        document.getElementById("calcResult").innerText = 'Tutar: 0 TL';
    }

    function calculate() {
        const adet = parseFloat(document.getElementById("adet").value);
        if (!isNaN(adet) && selected.price > 0) {
            const tutar = adet * selected.price;
            document.getElementById("calcResult").innerText = `Tutar: ${tutar.toFixed(2)} TL`;
        }
    }

    function submitTransaction() {
        const adet = parseFloat(document.getElementById("adet").value);
        if (!selected.name || isNaN(adet)) return alert("√úr√ºn ve adet girin.");
        const tutar = adet * selected.price;
        const date = new Date().toLocaleString();
        const kar = currentMode === 'satis' ? adet * (selected.price * 0.03) : 0;
        const data = { tarih: date, tur: currentMode.toUpperCase(), urun: selected.name, fiyat: selected.price, adet, tutar: tutar.toFixed(2), kar: kar.toFixed(2) };
        transactions.push(data);
        if (kar > 0) totalProfit += kar;
        saveToLocalStorage();
        renderTransactions();
        clearInput();
    }

    function renderTransactions() {
        const out = document.getElementById("transactionHistory");
        out.innerHTML = '<h3>üìã G√ºnl√ºk ƒ∞≈ülemler</h3>' + transactions.map(t =>
            `<div style='margin-bottom:10px;'><strong>${t.tur}</strong> ‚Äì ${t.urun} ‚Äì ${t.adet} √ó ${t.fiyat} TL = <strong>${t.tutar} TL</strong> ${t.kar > 0 ? `(<span style='color:lime'>+${t.kar} TL k√¢r</span>)` : ''}<br><small>${t.tarih}</small></div>`
        ).join('');
        document.getElementById("summaryBox").innerText = `Toplam K√¢r: ${totalProfit.toFixed(2)} TL`;
    }

    function saveToLocalStorage() {
        localStorage.setItem("transactions", JSON.stringify(transactions));
        localStorage.setItem("totalProfit", totalProfit.toFixed(2));
    }

    function loadFromLocalStorage() {
        const saved = localStorage.getItem("transactions");
        const savedProfit = localStorage.getItem("totalProfit");
        if (saved) transactions.push(...JSON.parse(saved));
        if (savedProfit) totalProfit = parseFloat(savedProfit);
        renderTransactions();
    }

    function clearTransactions() {
        if (confirm("T√ºm i≈ülemleri silmek istiyor musun?")) {
            transactions.length = 0;
            totalProfit = 0;
            localStorage.removeItem("transactions");
            localStorage.removeItem("totalProfit");
            renderTransactions();
        }
    }

    function checkPassword() {
        const correctPassword = "dogruel";
        const input = document.getElementById("passwordInput").value;
        if (input === correctPassword) {
            document.getElementById("loginPanel").classList.add("fade-out");
            setTimeout(() => document.getElementById("loginPanel").style.display = "none", 600);
        } else {
            document.getElementById("loginError").innerText = "‚ùå Hatalƒ± ≈üifre!";
        }
    }

    function exportToCSV() {
        let csv = "Tarih,ƒ∞≈ülem T√ºr√º,√úr√ºn,Fiyat,Adet,Tutar,K√¢r\n";
        transactions.forEach(t => {
            csv += `${t.tarih},${t.tur},${t.urun},${t.fiyat},${t.adet},${t.tutar},${t.kar}\n`;
        });
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "dogruel_islem_gecmisi.csv";
        a.click();
        URL.revokeObjectURL(url);
    }

    window.onload = () => {
        fetchPrices();
        setInterval(fetchPrices, 60000);
        loadFromLocalStorage();
        document.getElementById("passwordInput").addEventListener("keyup", e => {
            if (e.key === "Enter") checkPassword();
        });
        document.querySelectorAll("button[data-urun]").forEach(btn => {
            const urun = btn.getAttribute("data-urun");
            btn.onclick = () => {
                const fiyat = prices[urun] || 0;
                if (!fiyat) return alert(`${urun} fiyatƒ± hen√ºz hazƒ±r deƒüil.`);
                selectProduct(urun, fiyat);
            };
        });
        document.getElementById("exportBtn").addEventListener("click", exportToCSV);
    };
    </script>

</body>
</html>
